(function(e,t){if(typeof e=="undefined")e={};else if(typeof e!="object"&&typeof e!="function")throw"Failed to initialize SVC - invalid namespace";var n=e.svc={};n.VERSION=t;var r=Array.prototype.slice,i=function(){};n.Subject=Class.create({initialize:function(e){this._notificationToObservers={}},isEqual:function(e){return this===e},destroy:function(){this.notify("subject:destroy"),this._notificationToObservers={}},notifications:function(){return _.keys(this._notificationToObservers)},observers:function(){return _.chain(this._notificationToObservers).values().flatten().uniq().value()},notify:function(e){var t=this._notificationToObservers[e],n=r.call(arguments);n.shift(),n.unshift(this),t&&_.invoke(t,"apply",n)},subscribe:function(e,t){var n=this._notificationToObservers[e];n?n.push(t):this._notificationToObservers[e]=[t]},unsubscribe:function(e,t){var n=this._notificationToObservers[e];n&&(this._notificationToObservers[e]=_.without(n,t))}}),n.ModifiableSubject=Class.create(n.Subject,{initialize:function(e,t){e(t),this._dirty=!1},get:function(e){return this[":"+e]},properties:function(){var e=[];for(var t in this)t.charAt(0)===":"&&e.push(t.slice(1));return e},clean:function(){this._dirty=!1,this.notify("subject:clean")},dirty:function(){this._dirty=!0,this.notify("subject:dirty")},set:function(e,t,n){return this.get(e)==t?!1:(this[":"+e]=t,n||(this.notify("subject:change:"+e),this.dirty()),!0)},isDirty:function(){return this._dirty}}),n.Collection=Class.create(n.Subject,{initialize:function(e,t){e(t),this._collection=t.collection||[],this._sortFunction=t.sortFunction,this._sortFunction&&_.sortBy(this._collection,this._sortFunction)},at:function(e){if(!this.inRange(e))throw"svc.Collection.at: invalid index.";return this._collection[e]},get:function(e){return _.find(this._collection,function(t){return t.isEqual(e)})},getAll:function(){return this._collection},indexOf:function(e){var t=-1;return _.find(this._collection,function(n){return++t,n.isEqual(e)}),t===this.length?-1:t},inRange:function(e){return e>=0&&e<this.length},size:function(){return this._collection.length},add:function(e){if(this.get(e))return;this._collection.push(e),this._sortFunction&&_.sortBy(this._collection,this._sortFunction),this.notify("collection:add",e),e.notify("collection:add")},clear:function(){var e=this.getAll();this._collection=[],_.invoke(e,"notify","collection:clear"),this.notify("collection:clear")},remove:function(e){var t=this.get(e);if(!t)return;return this._collection=_.without(this._collection,t),t.notify("collection:remove"),this.notify("collection:remove",t),t}}),n.View=Class.create({initialize:function(e){this._subject=e.subject,this._element=this.draw(),this._subscribedFunctions={},this.subscribe("subject:destroy",_.bind(this.tearDown,this))},draw:function(){throw"View.js: draw must be defined in a subclass."},update:function(){},tearDown:function(){var e=this.getElement();if(e){e.hide();var t=e.parentNode;t&&t.removeChild(e)}this.unsubscribeAll()},getElement:function(){return this._element},getSubject:function(){return this._subject},subscribe:function(e,t){this._subscribedFunctions[e]=t,this.getSubject()&&this.getSubject().subscribe(e,t)},unsubscribe:function(e){var t=this._subscribedFunctions[e];delete this._subscribedFunctions[e],this.getSubject()&&this.getSubject().unsubscribe(e,t)},unsubscribeAll:function(){_.chain(_.keys(this._subscribedFunctions)).each(_.bind(this.unsubscribe,this))}}),n.ActionView=Class.create(n.View,{initialize:function(e,t){this._action=t.action,this._controller=t.controller,this._field=null,e(t),this._boundFireFunction=_.bind(this.fire,this),this.observeDOMEvents(t.events)},getField:function(){return this._field},observeDOMEvents:function(e){if(!this.getField())return;_.isArray(e)||(e=[e]),_.chain(e).uniq().compact().each(_.bind(function(e){this.getField().observe(e,this._boundFireFunction)},this))},fire:function(){var e=r.call(arguments);e.unshift(this.getSubject()),this._controller[this._action].apply(this._controller,e)}}),n.Controller=Class.create({initialize:function(e){}})})(function(){return this}(),"2.0");