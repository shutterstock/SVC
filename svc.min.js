(function(e,t){if(typeof e=="undefined")e={};else if(typeof e!="object"&&typeof e!="function")throw"Failed to initialize SVC - invalid namespace";var n=e.svc={};n.VERSION=t,n.Subject=Class.create({initialize:function(e){this._notificationToObservers=$H()},isEqual:function(e){return this===e},destroy:function(){this.notify("subject:destroy"),this._notificationToObservers=$H()},notify:function(e){var t=this._notificationToObservers.get(e),n=$A(arguments);n.shift(),n.unshift(this),t&&t.invoke("apply",null,n)},subscribe:function(e,t){var n=this._notificationToObservers.get(e);n?n.push(t):this._notificationToObservers.set(e,[t])},unsubscribe:function(e,t){var n=this._notificationToObservers.get(e);n&&this._notificationToObservers.set(e,n.without(t))}}),n.ModifiableSubject=Class.create(n.Subject,{initialize:function(e,t){e(t),this._dirty=!1},get:function(e){return this[":"+e]},properties:function(){var e=$A();for(var t in this)t.charAt(0)===":"&&e.push(t.slice(1));return e},clean:function(){this._dirty=!1,this.notify("subject:clean")},dirty:function(){this._dirty=!0,this.notify("subject:dirty")},set:function(e,t,n){return this.get(e)==t?!1:(this[":"+e]=t,n||(this.notify("subject:change:"+e),this.dirty()),!0)},isDirty:function(){return this._dirty}}),n.Collection=Class.create(n.Subject,{initialize:function(e,t){e(t),this._collection=$A(t.collection||[]),this._sortFunction=t.sortFunction,this._sortFunction&&this._collection.sort(this._sortFunction)},at:function(e){if(!this.inRange(e))throw"svc.Collection.at: invalid index.";return this._collection[e]},get:function(e){return this._collection.find(function(t){return t.isEqual(e)})},getAll:function(){return this._collection},indexOf:function(e){var t=-1;return this._collection.find(function(n){return++t,n.isEqual(e)}),t===this.size()?-1:t},inRange:function(e){return e>=0&&e<this.size()},size:function(){return this._collection.length},add:function(e){if(this.get(e))return;this._collection.push(e),this._sortFunction&&this._collection.sort(this._sortFunction),this.notify("collection:add",e),e.notify("collection:add")},clear:function(){var e=this.getAll();this._collection=$A(),e.invoke("notify","collection:clear"),this.notify("collection:clear")},remove:function(e){var t=this.get(e);if(!t)return;return this._collection=this._collection.without(t),t.notify("collection:remove"),this.notify("collection:remove",t),t},_each:function(e){this._collection._each(e)}}),n.Collection.addMethods(Enumerable),n.View=Class.create({initialize:function(e){this._subject=e.subject,this._element=this.draw(),this._subscribedFunctions=$H(),this.subscribe("subject:destroy",this.tearDown.bind(this))},draw:function(){throw"View.js: draw must be defined in a subclass."},update:function(){},tearDown:function(){var e=this.getElement();if(e){e.hide();var t=e.parentNode;t&&t.removeChild(e)}this.unsubscribeAll()},getElement:function(){return this._element},getSubject:function(){return this._subject},subscribe:function(e,t){this._subscribedFunctions.set(e,t),this.getSubject()&&this.getSubject().subscribe(e,t)},unsubscribe:function(e){var t=this._subscribedFunctions.get(e);this._subscribedFunctions.unset(e),this.getSubject()&&this.getSubject().unsubscribe(e,t)},unsubscribeAll:function(){this._subscribedFunctions.keys().each(this.unsubscribe.bind(this))}}),n.ActionView=Class.create(n.View,{initialize:function(e,t){this._action=t.action,this._controller=t.controller,this._field=null,e(t),this._boundFireFunction=this.fire.bind(this),this.observeDOMEvents(t.events)},getField:function(){return this._field},observeDOMEvents:function(e){if(!this.getField())return;Object.isArray(e)||(e=[e]),e.uniq().compact().each(function(e){this.getField().observe(e,this._boundFireFunction)}.bind(this))},fire:function(){var e=$A(arguments);e.unshift(this.getSubject()),this._controller[this._action].apply(this._controller,e)}}),n.Controller=Class.create({initialize:function(e){}}),n.AjaxController=Class.create(n.Controller,{initialize:function(e,t){e(t),this._actionPath=t.actionPath,this._actionMethod=t.actionMethod||"post"},makeRequest:function(e,t){var n=this.onSuccess.bind(this),r=t&&typeof t=="function"?n.wrap(t).bind(this):n,i=new Ajax.Request(this.path(),{method:this.method(),parameters:this.parameters().update(e),onCreate:this.onCreate.bind(this),onSuccess:r,onFailure:this.onFailure.bind(this),onComplete:this.onComplete.bind(this)})},method:function(){if(!this._actionMethod)throw"AjaxController.js: method must be defined";return this._actionMethod},onComplete:Prototype.emptyFunction,onCreate:Prototype.emptyFunction,onFailure:Prototype.emptyFunction,onSuccess:Prototype.emptyFunction,parameters:function(){return $H()},path:function(){if(!this._actionPath)throw"AjaxController.js: path must be defined";return this._actionPath}}),n.AjaxSingleRequestController=Class.create(n.AjaxController,{initialize:function(e,t){e(t),this._inProgress=!1},makeRequest:function(e,t,n){if(this._inProgress)return;this._inProgress=!0,e(t,n)},onComplete:function(){this._inProgress=!1}})})(function(){return this}(),"1.2");