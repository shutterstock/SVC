<!DOCTYPE html>  <html> <head>   <title>svc.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               svc.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">namespace</span><span class="p">,</span> <span class="nx">version</span><span class="p">){</span>

	<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="nx">namespace</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">namespace</span> <span class="o">=</span> <span class="p">{};</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="nx">namespace</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;object&quot;</span> <span class="o">||</span> <span class="k">typeof</span><span class="p">(</span><span class="nx">namespace</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">throw</span> <span class="s2">&quot;Failed to initialize SVC - invalid namespace&quot;</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="kd">var</span> <span class="nx">svc</span> <span class="o">=</span> <span class="nx">namespace</span><span class="p">.</span><span class="nx">svc</span> <span class="o">=</span> <span class="p">{};</span>
	<span class="nx">svc</span><span class="p">.</span><span class="nx">VERSION</span> <span class="o">=</span> <span class="nx">version</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h2>Subject </h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>The main work horse of our framework. This is a stripped down version of the Subject; it provides a very
simple equality test, the ability to destroy itself, notify events, and subscribe to/unsubscribe from
any notifications.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">svc</span><span class="p">.</span><span class="nx">Subject</span> <span class="o">=</span> <span class="nx">Class</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Our constructor just sets up the mapping from notifcations to functions.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">_notificationToObservers</span> <span class="o">=</span> <span class="nx">$H</span><span class="p">();</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Equality test is just a strict equals against another <code>subject</code> at this point. </p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">isEqual</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">subject</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="k">this</span> <span class="o">===</span> <span class="nx">subject</span><span class="p">;</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Destroy self. Notify that we are dead, and clear out all subscribed functions.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">destroy</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">notify</span><span class="p">(</span><span class="s1">&#39;subject:destroy&#39;</span><span class="p">);</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">_notificationToObservers</span> <span class="o">=</span> <span class="nx">$H</span><span class="p">();</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Notify that a particular <code>notification</code> happened. The first variable passed along will be the subject.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">notify</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">notification</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">observers</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_notificationToObservers</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">notification</span><span class="p">);</span>
		<span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">$A</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
		</pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Remove the notification from the arguments array.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">args</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
		</pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Add the subject as the first argument.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">args</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="nx">observers</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">observers</span><span class="p">.</span><span class="nx">invoke</span><span class="p">(</span><span class="s1">&#39;apply&#39;</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Add a subscription of a <code>f</code>unction call for a particular <code>notification</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">subscribe</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">notification</span><span class="p">,</span> <span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">observers</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_notificationToObservers</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">notification</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="nx">observers</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">observers</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">f</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">_notificationToObservers</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">notification</span><span class="p">,</span> <span class="p">[</span><span class="nx">f</span><span class="p">]);</span>
		<span class="p">}</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Remove a subscription of a <code>f</code>unction call for a particular <code>notification</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">unsubscribe</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">notification</span><span class="p">,</span> <span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">observers</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_notificationToObservers</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">notification</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="nx">observers</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">_notificationToObservers</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">notification</span><span class="p">,</span> <span class="nx">observers</span><span class="p">.</span><span class="nx">without</span><span class="p">(</span><span class="nx">f</span><span class="p">));</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <h2>ModifiableSubject</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>ModifiableSubject is a more specific implementation of the subject, which provides the ability to set
attributes and sending out default events for those events. It maintains flags to watch the state of the
object.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">svc</span><span class="p">.</span><span class="nx">ModifiableSubject</span> <span class="o">=</span> <span class="nx">Class</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">svc</span><span class="p">.</span><span class="nx">Subject</span><span class="p">,</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Create the object, setting the dirty flag to false.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$super</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">$super</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
		
		<span class="k">this</span><span class="p">.</span><span class="nx">_dirty</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
		</pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>TODO: automatically do silent sets for all values in args that aren't reserved</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Retrieve the particular value of a <code>property</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">get</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">property</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="k">this</span><span class="p">[</span><span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="nx">property</span><span class="p">];</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Get all the <code>properties</code> for a ModifiableSubject.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">properties</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">properties</span> <span class="o">=</span> <span class="nx">$A</span><span class="p">();</span>
		<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">property</span> <span class="k">in</span> <span class="k">this</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">property</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;:&#39;</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">properties</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">property</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="nx">properties</span><span class="p">;</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Set the object to be <code>clean</code> again. Notifies <code>subject:clean</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">clean</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">_dirty</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">notify</span><span class="p">(</span><span class="s1">&#39;subject:clean&#39;</span><span class="p">);</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Set the object to be <code>dirty</code>. Notifies <code>subject:dirty</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">dirty</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">_dirty</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">notify</span><span class="p">(</span><span class="s1">&#39;subject:dirty&#39;</span><span class="p">);</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Set a <code>property</code> to a particular <code>value</code>. If the <code>silent</code> flag is set, then no notification will be
made. If it isn't set (or is not included), the notification will be <code>subject:change:&lt;property&gt;</code>.
Returns true if the value is changed.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">set</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">property</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">silent</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">property</span><span class="p">)</span> <span class="o">==</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="p">}</span>
		<span class="k">this</span><span class="p">[</span><span class="s1">&#39;:&#39;</span> <span class="o">+</span> <span class="nx">property</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nx">silent</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">notify</span><span class="p">(</span><span class="s1">&#39;subject:change:&#39;</span> <span class="o">+</span> <span class="nx">property</span><span class="p">);</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">dirty</span><span class="p">();</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Checks to see if the object has changes.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">isDirty</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
		<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_dirty</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <h2>Collection </h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p><code>Collection</code>s are made up of <code>Subject</code>s, but are subjects as well. <code>Collection</code>s are useful for storing
all relevant subjects and applying notifcations to all items in the collection.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">svc</span><span class="p">.</span><span class="nx">Collection</span> <span class="o">=</span> <span class="nx">Class</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">svc</span><span class="p">.</span><span class="nx">Subject</span><span class="p">,</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Our constructor expects one variable labeled <code>collection</code>, which can
be an array of subjects. It also can take a <code>sortFunction</code> that can be used to sort the collection</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$super</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">$super</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">_collection</span> <span class="o">=</span> <span class="nx">$A</span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">collection</span> <span class="o">||</span> <span class="p">[]);</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">_sortFunction</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">sortFunction</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_sortFunction</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">_collection</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_sortFunction</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">},</span>
	</pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Get a value in the <code>Collection</code> from a particular <code>index</code>. Will throw errors for bad indices.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">at</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="k">this</span><span class="p">.</span><span class="nx">inRange</span><span class="p">(</span><span class="nx">index</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">throw</span> <span class="s1">&#39;svc.Collection.at: invalid index.&#39;</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_collection</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>Get a particular <code>subject</code> from the <code>collection</code>. Uses the <code>subject</code>s isEqual property to get the object,
returns <code>null</code> if nothing is found.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">get</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">subject</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_collection</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span>
			<span class="kd">function</span> <span class="p">(</span><span class="nx">entry</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">return</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">isEqual</span><span class="p">(</span><span class="nx">subject</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">);</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>Return all items in the collection.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">getAll</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
		<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_collection</span><span class="p">;</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>Determines where a <code>subject</code> is in the <code>collection</code>. Uses the <code>subject</code>s isEqual property to get the object,
and will return -1 if not found.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">indexOf</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">subject</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">_collection</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span>
			<span class="kd">function</span> <span class="p">(</span><span class="nx">entry</span><span class="p">)</span> <span class="p">{</span>
				<span class="o">++</span><span class="nx">index</span><span class="p">;</span>
				<span class="k">return</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">isEqual</span><span class="p">(</span><span class="nx">subject</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">);</span>

		<span class="k">return</span> <span class="nx">index</span> <span class="o">===</span> <span class="k">this</span><span class="p">.</span><span class="nx">size</span><span class="p">()</span> <span class="o">?</span> <span class="o">-</span><span class="mi">1</span> <span class="o">:</span> <span class="nx">index</span><span class="p">;</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>Determines whether or not an index fits into the <code>collection</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">inRange</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">index</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">index</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">size</span><span class="p">();</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>Returns the size of the collection.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">size</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
		<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_collection</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>Add a <code>subject</code> to the <code>collection</code> if it isn't already in the <code>collection</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">add</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">subject</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">subject</span><span class="p">))</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">_collection</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">subject</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_sortFunction</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">_collection</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_sortFunction</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">notify</span><span class="p">(</span><span class="s1">&#39;collection:add&#39;</span><span class="p">,</span> <span class="nx">subject</span><span class="p">);</span>
		<span class="nx">subject</span><span class="p">.</span><span class="nx">notify</span><span class="p">(</span><span class="s1">&#39;collection:add&#39;</span><span class="p">);</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>Remove all <code>subject</code>s from the <code>collection</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">clear</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">cleared</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getAll</span><span class="p">();</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">_collection</span> <span class="o">=</span> <span class="nx">$A</span><span class="p">();</span>
		<span class="nx">cleared</span><span class="p">.</span><span class="nx">invoke</span><span class="p">(</span><span class="s1">&#39;notify&#39;</span><span class="p">,</span> <span class="s1">&#39;collection:clear&#39;</span><span class="p">);</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">notify</span><span class="p">(</span><span class="s1">&#39;collection:clear&#39;</span><span class="p">);</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>Remove a single <code>subject</code> from the <code>collection</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">remove</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">subject</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">entry</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">subject</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nx">entry</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">_collection</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_collection</span><span class="p">.</span><span class="nx">without</span><span class="p">(</span><span class="nx">entry</span><span class="p">);</span>
		<span class="nx">entry</span><span class="p">.</span><span class="nx">notify</span><span class="p">(</span><span class="s1">&#39;collection:remove&#39;</span><span class="p">);</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">notify</span><span class="p">(</span><span class="s1">&#39;collection:remove&#39;</span><span class="p">,</span> <span class="nx">entry</span><span class="p">);</span>
		<span class="k">return</span> <span class="nx">entry</span><span class="p">;</span>
	<span class="p">},</span>

	<span class="nx">_each</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">iterator</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">_collection</span><span class="p">.</span><span class="nx">_each</span><span class="p">(</span><span class="nx">iterator</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>Mixin <code>Enumerable</code> functionality.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">svc</span><span class="p">.</span><span class="nx">Collection</span><span class="p">.</span><span class="nx">addMethods</span><span class="p">(</span><span class="nx">Enumerable</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <h2>View</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>The base View class of the SVC. It will automatically make a call to 'draw' the element on the page.
If the element is already on the page, this function can be used to locate and store pointers to the 
elements on the page. It also handles destroying itself when told to. It provides some often used
getter methods and also provides methods to subscribe to (and unsubscribe from) nofitications from
the subject.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">svc</span><span class="p">.</span><span class="nx">View</span> <span class="o">=</span> <span class="nx">Class</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>Our constructor calls draw and subscribes a teardown method to the destroy event. It requires a 
<code>subject</code> variable which will be the <code>Subject</code> the view subscribes to.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">_subject</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">subject</span><span class="p">;</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">_element</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">draw</span><span class="p">();</span>

		<span class="k">this</span><span class="p">.</span><span class="nx">_subscribedFunctions</span> <span class="o">=</span> <span class="nx">$H</span><span class="p">();</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="s1">&#39;subject:destroy&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">tearDown</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
	<span class="p">},</span>
	</pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>This will be where you define the main element of a view, you can also define other elements
which can be stored as instance variables to reduce page wide scans.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">draw</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
		<span class="k">throw</span> <span class="s2">&quot;View.js: draw must be defined in a subclass.&quot;</span><span class="p">;</span>
	<span class="p">},</span>
	</pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>This will need to go, but is required for now.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">update</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>stub method, needs to be impemented in subclasses as well.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="p">},</span>
	</pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>The default method that gets called when the subject is destroyed. It removes the element
from the page and unsubscribes all events. Feel free to override it as needed.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">tearDown</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">element</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getElement</span><span class="p">();</span>
		<span class="k">if</span> <span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">element</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
			<span class="kd">var</span> <span class="nx">parentElement</span> <span class="o">=</span> <span class="nx">element</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="nx">parentElement</span><span class="p">)</span> <span class="p">{</span> <span class="nx">parentElement</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span> <span class="p">}</span>
		<span class="p">}</span>
		
		<span class="k">this</span><span class="p">.</span><span class="nx">unsubscribeAll</span><span class="p">();</span>
	<span class="p">},</span>
	</pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>Gets the main <code>element</code> of the view.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">getElement</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
		<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_element</span><span class="p">;</span>
	<span class="p">},</span>
	</pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>Get the <code>subject</code> the view is watching. </p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">getSubject</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
		<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_subject</span><span class="p">;</span>
	<span class="p">},</span>
	</pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>Subscribe a <code>function</code> to a particular <code>notification</code> issued by the subject.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">subscribe</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">notification</span><span class="p">,</span> <span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">_subscribedFunctions</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">notification</span><span class="p">,</span> <span class="nx">fn</span><span class="p">);</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">getSubject</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">getSubject</span><span class="p">().</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">notification</span><span class="p">,</span> <span class="nx">fn</span><span class="p">);</span>
	<span class="p">},</span>
	</pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>Unsubscribe from a particular <code>notification</code> issued by the <code>subject</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">unsubscribe</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">notification</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">fn</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_subscribedFunctions</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">notification</span><span class="p">);</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">_subscribedFunctions</span><span class="p">.</span><span class="nx">unset</span><span class="p">(</span><span class="nx">notification</span><span class="p">);</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">getSubject</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">getSubject</span><span class="p">().</span><span class="nx">unsubscribe</span><span class="p">(</span><span class="nx">notification</span><span class="p">,</span> <span class="nx">fn</span><span class="p">);</span>
	<span class="p">},</span>
	</pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>Clear out all subscribed functions for the view.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">unsubscribeAll</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">_subscribedFunctions</span><span class="p">.</span><span class="nx">keys</span><span class="p">().</span><span class="nx">each</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">unsubscribe</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
	<span class="p">}</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <h2>ActionView</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p><code>ActionView</code>s modify the model based on user input. Subclasses must implement a <code>draw</code> method (from the
<code>View</code> class) and define a <code>field</code>, which is what the user interacts with. They also should define
a list of <code>events</code> that the field should respond to.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">svc</span><span class="p">.</span><span class="nx">ActionView</span> <span class="o">=</span> <span class="nx">Class</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">svc</span><span class="p">.</span><span class="nx">View</span><span class="p">,</span> <span class="p">{</span>
		</pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>Our initializer takes an <code>action</code>, <code>controller</code>, and <code>events</code> along with the variables a <code>View</code> needs. The 
<code>controller</code> is a <code>Controller</code> object and the <code>action</code> is the name of the function you wish to call
when the user completes the required action. Users define <code>events</code> that the view will respond to.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$super</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
		
		<span class="k">this</span><span class="p">.</span><span class="nx">_action</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">action</span><span class="p">;</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">_controller</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">controller</span><span class="p">;</span>
		</pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p><code>field</code> gets set in draw()</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">this</span><span class="p">.</span><span class="nx">_field</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

		<span class="nx">$super</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>We store the fire function so it can be unregistered later.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">this</span><span class="p">.</span><span class="nx">_boundFireFunction</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">fire</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

		<span class="k">this</span><span class="p">.</span><span class="nx">observeDOMEvents</span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">events</span><span class="p">);</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>Get the <code>ActionView</code>s <code>field</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">getField</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
		<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_field</span><span class="p">;</span>
	<span class="p">},</span>
	</pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>We associate the passed in <code>events</code> with the view so that the view will call out to the controller
when it's interacted with.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">observeDOMEvents</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">events</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p>We don't operate on <code>ActionView</code>s without fields.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="k">this</span><span class="p">.</span><span class="nx">getField</span><span class="p">())</span> <span class="p">{</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">Object</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">events</span><span class="p">))</span> <span class="p">{</span>
			<span class="nx">events</span> <span class="o">=</span> <span class="p">[</span><span class="nx">events</span><span class="p">];</span>
		<span class="p">}</span>

		<span class="nx">events</span><span class="p">.</span><span class="nx">uniq</span><span class="p">().</span><span class="nx">compact</span><span class="p">().</span><span class="nx">each</span><span class="p">(</span>
			<span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">this</span><span class="p">.</span><span class="nx">getField</span><span class="p">().</span><span class="nx">observe</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_boundFireFunction</span><span class="p">);</span>
			<span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
		<span class="p">);</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>We call the desired <code>action</code> in the <code>controller</code> and include the <code>subject</code> as the first variable. </p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">fire</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">$A</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
		<span class="nx">args</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getSubject</span><span class="p">());</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">_controller</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">_action</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_controller</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <h2>Controller</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p>The base controller. It doesn't do anything, except provide an inheritence chain.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">svc</span><span class="p">.</span><span class="nx">Controller</span> <span class="o">=</span> <span class="nx">Class</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
	<span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
	<span class="p">}</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <h2>AjaxController</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p>A wrapper around prototypes <code>Ajax.Request</code> object, this allows us to override methods and 
set default values such as post method and path in an object-based format.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">svc</span><span class="p">.</span><span class="nx">AjaxController</span> <span class="o">=</span> <span class="nx">Class</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">svc</span><span class="p">.</span><span class="nx">Controller</span><span class="p">,</span> <span class="p">{</span>
		</pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p>Our initializer takes an <code>actionMethod</code> and an <code>actionPath</code> in order to define how
we communicate with the server and where we talk to.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$super</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">$super</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">_actionPath</span>   <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">actionPath</span><span class="p">;</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">_actionMethod</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">actionMethod</span> <span class="o">||</span> <span class="s1">&#39;post&#39;</span><span class="p">;</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <p>Make a request to the <code>path</code> on the server, passing whatever <code>args</code> are included as parameters.
We're adding a <code>callback</code> here to be called <code>onComplete</code>, but we should really rethink this.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">makeRequest</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">args</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">boundOnSuccess</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">onSuccess</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
		<span class="kd">var</span> <span class="nx">wrappedSuccess</span> <span class="o">=</span> <span class="nx">callback</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span> <span class="o">?</span> <span class="nx">boundOnSuccess</span><span class="p">.</span><span class="nx">wrap</span><span class="p">(</span><span class="nx">callback</span><span class="p">).</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="o">:</span> <span class="nx">boundOnSuccess</span><span class="p">;</span>
		<span class="kd">var</span> <span class="nx">req</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Ajax</span><span class="p">.</span><span class="nx">Request</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">path</span><span class="p">(),</span> <span class="p">{</span>
			<span class="nx">method</span><span class="o">:</span>     <span class="k">this</span><span class="p">.</span><span class="nx">method</span><span class="p">(),</span>
			<span class="nx">parameters</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">parameters</span><span class="p">().</span><span class="nx">update</span><span class="p">(</span><span class="nx">args</span><span class="p">),</span>
			<span class="nx">onCreate</span><span class="o">:</span>   <span class="k">this</span><span class="p">.</span><span class="nx">onCreate</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span>
			<span class="nx">onSuccess</span><span class="o">:</span>  <span class="nx">wrappedSuccess</span><span class="p">,</span>
			<span class="nx">onFailure</span><span class="o">:</span>  <span class="k">this</span><span class="p">.</span><span class="nx">onFailure</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span>
			<span class="nx">onComplete</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">onComplete</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
		<span class="p">});</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p>Defines the <code>method</code> of the request (usually <code>POST</code> or <code>GET</code>).</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">method</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="k">this</span><span class="p">.</span><span class="nx">_actionMethod</span><span class="p">)</span> <span class="p">{</span> <span class="k">throw</span> <span class="s2">&quot;AjaxController.js: method must be defined&quot;</span><span class="p">;</span> <span class="p">}</span>
		<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_actionMethod</span><span class="p">;</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <p>The method called when the AJAX request is completed.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">onComplete</span><span class="o">:</span> <span class="nx">Prototype</span><span class="p">.</span><span class="nx">emptyFunction</span><span class="p">,</span>
	</pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p>The method called when the AJAX request is created.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">onCreate</span><span class="o">:</span>   <span class="nx">Prototype</span><span class="p">.</span><span class="nx">emptyFunction</span><span class="p">,</span>
	</pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <p>The method called when the AJAX request fails.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">onFailure</span><span class="o">:</span>  <span class="nx">Prototype</span><span class="p">.</span><span class="nx">emptyFunction</span><span class="p">,</span>
	</pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <p>The method called when the AJAX request succeeds.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">onSuccess</span><span class="o">:</span>  <span class="nx">Prototype</span><span class="p">.</span><span class="nx">emptyFunction</span><span class="p">,</span>
	</pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <p>An object representing the parameters, this should be extended or overwritten.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">parameters</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">$H</span><span class="p">();</span> <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <p>Retrieves the <code>actionPath</code> of the request.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">path</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="k">this</span><span class="p">.</span><span class="nx">_actionPath</span><span class="p">)</span> <span class="p">{</span> <span class="k">throw</span> <span class="s2">&quot;AjaxController.js: path must be defined&quot;</span><span class="p">;</span> <span class="p">}</span>
		<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_actionPath</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <h2>AjaxSingleRequestController</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-70">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-70">&#182;</a>               </div>               <p>This creates a simple mutex lock on AJAX queries so that only one happens at a time. It inherits from
the normal <code>AjaxController</code></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">svc</span><span class="p">.</span><span class="nx">AjaxSingleRequestController</span> <span class="o">=</span> <span class="nx">Class</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">svc</span><span class="p">.</span><span class="nx">AjaxController</span><span class="p">,</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-71">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-71">&#182;</a>               </div>               <p>Our initializer is the same as <code>AjaxController</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$super</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">$super</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">_inProgress</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
	<span class="p">},</span>
	</pre></div>             </td>           </tr>                               <tr id="section-72">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-72">&#182;</a>               </div>               <p>Make a request if nothing is in progress.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">makeRequest</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$super</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_inProgress</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">_inProgress</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
		<span class="nx">$super</span><span class="p">(</span><span class="nx">args</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
	<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-73">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-73">&#182;</a>               </div>               <p>When the request finishes, unlock the progress lock</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">onComplete</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="nx">_inProgress</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span> <span class="p">}</span>
<span class="p">});</span>
<span class="p">})(</span><span class="kc">null</span> <span class="o">||</span> <span class="p">(</span><span class="kd">function</span><span class="p">(){</span> <span class="k">return</span> <span class="k">this</span><span class="p">;</span> <span class="p">})(),</span> <span class="s2">&quot;1.1&quot;</span><span class="p">);</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 
